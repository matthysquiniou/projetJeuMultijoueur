#include "pch.h"

cpu_time::cpu_time()
{
	Reset();
}

cpu_time::~cpu_time()
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

cpu_time& cpu_time::GetInstance()
{
	static cpu_time time;
	return time;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void cpu_time::Reset()
{
	sysTime = timeGetTime();
	totalTime = 0.0f;
	deltaTime = 0.0f;
	fpsTime = 0;
	fpsCount = 0;
	fpsResult = 0;
}

bool cpu_time::Update()
{
	DWORD curTime = timeGetTime();
	DWORD dt = curTime - sysTime;
	if ( dt<5 )
		return false;

	sysTime = curTime;
	if ( dt>30 )
		dt = 30;
	deltaTime = dt/1000.0f;
	totalTime += deltaTime;

	if ( sysTime-fpsTime>=1000 )
	{
		fpsResult = fpsCount;
		fpsCount = 0;
		fpsTime = sysTime;
	}
	else
		fpsCount++;

	return true;
}
